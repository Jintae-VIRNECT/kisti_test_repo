server:
  port: 8073
  ssl:
    enabled: true
    key-store: virnect.pfx
    key-store-type: PKCS12
    key-store-password: 123456

spring:
  application:
    name: gateway-server-local
  cloud:
    gateway:
      routes:
        - id: auth-server
          uri: http://192.168.13.91:8321
          predicates:
            - Path=/auth/**, /v1/auth/**
          filters:
            - StripPrefix=0
            - RewritePath=/auth/v2/(?<segment>.*), /v2/$\{segment}
            - RewritePath=/v1/auth/v2/(?<segment>.*), /v2/$\{segment}

        - id: user-server
          uri: https://192.168.6.3:18081
          predicates:
            - Path=/users/**
          filters:
            - StripPrefix=0
            - RewritePath=/users/v2/(?<segment>.*), /v2/$\{segment}

        - id: workspace-server
          uri: https://192.168.6.3:18082
          predicates:
            - Path=/workspaces/**
          filters:
            - StripPrefix=0
            - RewritePath=/workspaces/v2/(?<segment>.*), /v2/$\{segment

      globalcors:
        corsConfigurations:
          "[/**]":
            allowedOrigins:
              - "*"
            allowedMethods: "*"
            allowedHeaders: "*"
      default-filters:
        - MessageEncryptDecryptFilter
      x-forwarded:
        prefix-enabled: false
      httpclient:
        ssl:
          #          key-store: virnect.pfx
          #          key-store-type: PKCS12
          #          key-store-password: 123456
          use-insecure-trust-manager: true
        # 클라이언트 <-> 게이트웨이 <-> 다운스트림 서버 request response 로깅
#        wiretap: true
  zipkin:
    base-url: http://192.168.6.3:9411
    enabled: false
  redis:
    host: 192.168.13.11
    port: 6379
  sleuth:
    enabled: false
  session:
    store-type: redis
    redis:
      namespace: session


eureka:
  instance:
    prefer-ip-address: true
  client:
    service-url:
      defaultZone: http://192.168.6.3:8761/eureka
    registry-fetch-interval-seconds: 3
    enabled: false

jwt:
  secret: 2020-tcenriv-platform-392


# gateway 서버 디버깅용 로깅 추가
logging:
  level:
    org.springframework.web.server: TRACE
    org.springframework.session: TRACE
    org.springframework.cloud.gateway: TRACE

#ribbon:
#  eureka:
#    enabled: false

cookie:
  session:
    domain: localhost
    name: DVSESSION
    path: "/"
  remember-me:
    domain: localhost
    name: rememberMe
    path: "/v1/auth/signin"
    valid-seconds: 3600